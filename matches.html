<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <title>Team Results</title>
  <style>
    #flagTitle img{
      height: 30px;
      width: auto;
    }

    .match {
      text-align : center ;
    }

    a {
      text-decoration: none;
      color: rgb(0, 50, 100);
      cursor: pointer;
    }

    .container {
      max-width: 2000px;
    }

    .flag
    {
      width: 20px;
      height: auto;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container mt-5">
    <h1 class="mb-4"><a href="./"><i class="fa fa-home"></i></a> <a id="flagTitle"></a> <a id="h1title"></a></h1>

    <table class="table table-striped" id="teamResultsTable">
      <thead class="thead-dark">
        <tr>
          <th style="width:110px;">Date</th>
          <th data-toggle="tooltip" title="Location of the match">Location</th>
          <th data-toggle="tooltip" title="Tournament of the match">Tournament</th>
          <th data-toggle="tooltip" title="Opponent of the match">Opponent</th>
          <th data-toggle="tooltip" title="Level of the team">Lvl.1</th>
          <th data-toggle="tooltip" title="Level of the opponent">Lvl.2</th>
          <th data-toggle="tooltip" title="Victory chances for the team">Win%</th>
          <th class="match" data-toggle="tooltip" title="Final score of the match">Score</th>
          <th data-toggle="tooltip" title="Level and Points evolution for the team">New Level</th>
        </tr>
      </thead>
      <tbody id="team-results-body">
        <!-- Results will be inserted here -->
      </tbody>
    </table>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Extract team name from the URL
      const teamName = decodeURIComponent(new URLSearchParams(window.location.search).get('team'));

      // Default JSON file path for team results (adjust as needed)
      const jsonFilePath = `data/json/matches/${teamName}.json`;

      // Modifiy page name and h1 title
      document.title = `${teamName} Results`;
      document.getElementById('h1title').textContent = teamName + " Results";

      // Function to load team results JSON file
      async function loadTeamResultsJSON(filePath) {
        const response = await fetch(filePath);
        const jsonData = await response.json();
        return jsonData;
      }

      // Reference to team results table body
      const teamResultsBody = document.getElementById('team-results-body');

      // Initial JSON loading
      loadTeamResultsJSON(jsonFilePath).then(teamResultsData => {
        console.log('Team Results Data:', teamResultsData);

        // Extracting flag value for title
        const firstLine = teamResultsData.matches[0];
        const flag1Value = firstLine.flag1;
        const flagA = document.getElementById('flagTitle');
        if (flagA) {
            flagA.innerHTML = `<img src="img/flags/${flag1Value}" alt="${teamName}">`;
        }

        const matchesArray = teamResultsData.matches || [];
        // Loop through team results data and construct table rows
        matchesArray.forEach(match => {
          var color;
          if(match.score1 - match.score2 > 0) {
            color = 'green';
          }
          else if (match.score1 - match.score2 < 0) {
            color = 'red';
          }
          else {
            color = 'black';
          }
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${match.date}</td>
            <td>${match.country}</td>
            <td>${match.tournament}</td>
            <td>vs <a href="matches.html?team=${match.team2.replace(/&/g, "%26")}"><img class="flag" src="img/flags/${match.flag2}" alt="${match.team2}"></a> <a href="matches.html?team=${match.team2}">${match.original_team2}</a></td>
            <td>${Math.round(match.rating1-match.rating_ev)}</td>
            <td>${Math.round(match.rating2+match.rating_ev)}</td>
            <td>${match.win_prob} %</td>
            <td class="match" style="color:${color};"><b>${match.score1} - ${match.score2}</b></td>
            <td>${Math.round(match.rating1)} (${match.rating_ev >= 0 ? '+' : ''}${Math.round(match.rating_ev)})</td>
          `;
          teamResultsBody.appendChild(row);
        });
      });
    });
  </script>
</body>
</html>
